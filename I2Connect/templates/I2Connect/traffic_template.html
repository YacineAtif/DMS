<!-- I2Connect/templates/I2Connect/traffic_template.html -->

<!-- Your HTML Template (e.g., traffic_template.html) -->

<!DOCTYPE html>
<html>
<head>
    <title>Traffic Data</title>
    <style>
        #data-container {
            max-height: 300px; /* Adjust height as needed */
            overflow-y: auto;  /* Enable vertical scrolling */
            font-family: monospace;â‰¤
        }
    </style>
</head>

<body>
    <h1>Simulated Traffic Data</h1>
    <button id="startBtn">Start </button>
    <button id="pauseBtn">Pause </button>
    <button id="resumeBtn">Resume </button>
   <!-- <button id="stopBtn">Stop </button> -->
    <div id="data-container"></div>

    <script type="text/javascript">


     // Construct the WebSocket URL based on the current location
    const wsScheme = window.location.protocol === "https:" ? "wss" : "ws";
    const wsHost = window.location.host; // Host includes hostname and port if applicable
    const wsPath = "/ws/traffic/";

    const trafficSocket = new WebSocket(`${wsScheme}://${wsHost}${wsPath}`);

    //const trafficSocket = new WebSocket('ws://localhost:8000/ws/traffic/');

    trafficSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const node = document.createElement("p");
        const textnode = document.createTextNode(`ID: ${data.id}, Timestamp: ${data.timestamp}, X: ${data.x.toFixed(6)}, Y: ${data.y.toFixed(6)}, Speed: ${data.speed.toFixed(6)} km/h, Type: ${data.type}`);
        node.appendChild(textnode);

        const container = document.getElementById("data-container");
        container.appendChild(node);

        // Auto-scroll to the bottom of the container
        container.scrollTop = container.scrollHeight;
    };

    trafficSocket.onclose = function(e) {
        console.error('Webpage closed: Traffic socket closed unexpectedly');
    };

    // Function to clear data
    function clearData() {
        const container = document.getElementById("data-container");
        container.innerHTML = '';  // Clear the container
    }

    // Optionally, clear data periodically
    setInterval(clearData, 60000);  // Clear data every 60 seconds

    document.getElementById('startBtn').addEventListener('click', function() {
    // Code to start the simulation
    clearData();
    trafficSocket.send(JSON.stringify({ action: 'start' }));
    });

    document.getElementById('pauseBtn').addEventListener('click', function() {
        // Code to pause the simulation
        trafficSocket.send(JSON.stringify({ action: 'pause' }));
    });

    document.getElementById('resumeBtn').addEventListener('click', function() {
        // Code to resume the simulation
        trafficSocket.send(JSON.stringify({ action: 'resume' }));
    });

    document.getElementById('stopBtn').addEventListener('click', function() {
    // Send a message to the server to stop the simulation, or simply close the WebSocket
    //trafficSocket.send(JSON.stringify({ action: 'stop' }));  // Example if sending a message
    if (trafficSocket.readyState === WebSocket.OPEN) {
        console.error('WebSocket is open.');
        trafficSocket.send(JSON.stringify({ action: 'stop' }));
    } else {
        console.error('WebSocket is not open.');
    }

    // trafficSocket.close();  // Example if directly closing the WebSocket
    });



</script>

</body>
</html>

